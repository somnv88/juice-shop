name: ZAP Full Scan

on:
  push:
    branches: [main]

# Needed so the action can open/update an Issue with alerts
permissions:
  contents: read
  issues: write

jobs:
  zap-full-scan:
    runs-on: ubuntu-latest
    env:
      # Fallback order: manual input → repo variable → secret
      # TARGET: ${{ github.event_name == 'workflow_dispatch' && inputs.target_url || vars.ZAP_TARGET || secrets.ZAP_TARGET }}
      TARGET: "http://98.91.2.223:3000/"
      # Optional header-based auth copied into the ZAP container automatically
      # Remove if not used
      # ZAP_AUTH_HEADER: Authorization
      # ZAP_AUTH_HEADER_VALUE: ${{ secrets.ZAP_BEARER }}
      # ZAP_AUTH_HEADER_SITE: ${{ env.TARGET }}

    steps:
      - name: Checkout (needed if you use .zap/rules.tsv)
        uses: actions/checkout@v4

      - name: Ensure target provided
        run: |
          if [ -z "${TARGET}" ]; then
            echo "TARGET not set. Provide inputs.target_url or define repo var ZAP_TARGET or secret ZAP_TARGET."
            exit 1
          fi

      - name: ZAP Full Scan
        uses: zaproxy/action-full-scan@v0.13.0
        with:
          # token: ${{ secrets.GITHUB_TOKEN }}
          # docker_name: ghcr.io/zaproxy/zaproxy:stable
          target: ${{ env.TARGET }}
          # rules_file_name: .zap/rules.tsv         # optional ignore/level overrides
          # fail_action: 'true'                     # fail job if any alerts
          # allow_issue_writing: 'true'             # create/update GitHub Issue with results
          # artifact_name: zap_full_scan            # HTML/JSON report attached to run
